# SlurmX

## File Structure

```
|-- CMakeModule         Some useful cmake macros.
|-- dependencies        The dependencies that the project needs.
|   |-- cmake           Dependencies that use CmakeList to download.
|   |-- online          The install dir of compiled dependencies in tarballs
|   |-- pre_installed   Some header-only libs stored in git repo. No downloading needed.
|   `-- tarballs        The archieves of dependencies is downloaded into this foleder.
|-- generated           The generated code of protobuf files.
|   |-- protos
|   `-- test
|-- protos              The protobuf files.
|-- src                 Source code dir.
|   |-- SlurmCtlXd      
|   |-- SlurmXd
|   `-- Utilities       Some function needed both by SlurmCtlXd and SlurmXd.
`-- test                Test codes.
    |-- Misc            Some codes for idea proving purpose and not related to this project.
    |-- protos          Test codes for gRPC functions.
    |-- SharedTestImpl  Functions that all test codes need.
    |-- SlurmCtlXd      Test codes for SlurmCtlXd.
    |-- SlurmXd         Test codes for SlurmXd.
    `-- Utilities       Test codes for Utilities.
```

## Development Plan

### All

- [ ] Use the data structure generated by protobuf instead of a duplicated C++ version.
- [ ] LibEvent->LibUv
- [ ] Add multiple node support for a task.

### SlurmCtlXd

- [ ] Fix bugs in the scheduling algorithm. 22/10/12
- [ ] Persistence of task queues
  - [ ] Investigate the db table in slurm.

### SlurmXd

- [ ] Add GPU Isolation in cgroup.
- [ ] Support output file name pattern.

### SBatchX

- [ ] Implement a simple parser of sbatch file. 22/01/10-22/01/10
- [ ] acquire UID of invoking user 22/01/11-22/01/11
- [ ] --time arg. Adapt "hh:mm:ss" format 22/01/11-22/01/11
- [ ] -o arg, -e arg
- [ ] --node arg, --task-per-node arg
  - [ ] Implementation in the backend. 22/01/13-22/01/14
  - [ ] Write an MPI test program and fix bugs. 22/01/15-22/01/16
- [ ] -p arg
- [ ] -J arg

## What has been implemented

### SlurmCtlXd

- [x] Basic support for task submission, termination and querying.
- [x] Basic scheduling algorithm.

### SlurmXd

- [x] Resource constraint on CPU and memory based on cgroup.
- [x] Basic task output redirection.
- [x] Termination for timed out tasks

### SBatchX

- [x] Simplest batch task submission grammar support.